<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>üîê Secret Cipher ‚Äî Cloud Upgrade</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --glass: rgba(255,255,255,0.08);
      --card-glow: 0 8px 30px rgba(0,0,0,0.45);
      --accent1: #ff5f8b;
      --accent2: #7b61ff;
      --accent3: #00f0ff;
      --accent4: #5efc82;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family: Inter,"Segoe UI",Arial,sans-serif;color:#fff;
      min-height:100vh;display:flex;flex-direction:column;
      background:linear-gradient(135deg,#0a0f1f,#0d1117 40%,#121826 100%);
    }
    header{padding:20px;text-align:center;background:rgba(0,0,0,0.3)}
    main{flex:1;display:flex;gap:20px;padding:20px;flex-wrap:wrap;justify-content:center}
    section,aside{min-width:320px;flex:1;border-radius:16px;padding:18px;background:var(--glass);
      box-shadow:var(--card-glow);backdrop-filter:blur(8px)}
    textarea{width:100%;min-height:110px;border-radius:12px;border:0;padding:12px;margin:10px 0;
      background:rgba(0,0,0,0.35);color:#fff;font-size:15px}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;color:#fff;
      background-image:linear-gradient(90deg,rgba(255,95,139,0.95),rgba(123,97,255,0.95))}
    button.secondary{background-image:linear-gradient(90deg,#00c6ff,#0072ff)}
    button.danger{background-image:linear-gradient(90deg,#ff8a65,#e53935)}
    .history-item{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(0,0,0,0.14);font-size:14px}
    #toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);
      padding:10px 16px;border-radius:22px;opacity:0;transition:.25s}
    #toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
    #loginScreen{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:99}
    #loginBox{background:#1a1f2f;padding:20px;border-radius:12px;width:300px}
    input{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:0;background:rgba(255,255,255,0.1);color:#fff}
  </style>
</head>
<body>
  <!-- Login -->
  <div id="loginScreen">
    <div id="loginBox">
      <h2>üîë Login / Sign Up</h2>
      <input id="username" placeholder="Email">
      <input id="password" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
      <button onclick="signup()" class="secondary">Sign Up</button>
    </div>
  </div>

  <header>
    <h1>üîê Secret Cipher</h1>
    <p id="welcomeUser"></p>
    <button onclick="logout()" class="danger">Logout</button>
  </header>

  <main>
    <section>
      <h3>üìù Cipher Tool</h3>
      <textarea id="input" placeholder="Type message..."></textarea>
      <textarea id="output" readonly placeholder="Result..."></textarea>
      <div class="controls">
        <button onclick="encode()">Encode</button>
        <button onclick="decode()">Decode</button>
        <button onclick="smartDetect()">Smart Detect</button>
        <button onclick="copyResult()" class="secondary">Copy</button>
        <button onclick="clearAll()" class="danger">Clear</button>
      </div>
    </section>
    <aside>
      <h3>üìú History (Cloud)</h3>
      <div id="history"></div>
      <button onclick="clearHistory()" class="danger">Clear History</button>
    </aside>
  </main>

  <footer style="text-align:center;padding:10px">¬© <span id="year"></span></footer>
  <div id="toast"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    signOut,
    onAuthStateChanged 
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { 
    getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc 
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0fDcEpw-p7DNu0UkqIGtC782y1Vdf08",
    authDomain: "cipher-e6c22.firebaseapp.com",
    projectId: "cipher-e6c22",
    storageBucket: "cipher-e6c22.firebasestorage.app",
    messagingSenderId: "345358817477",
    appId: "1:345358817477:web:45cb83f8c8462191983ac",
    measurementId: "G-ENGQK77N8B"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  async function signup() {
    const email = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      toast("‚úÖ Account created!");
    } catch (e) { toast("‚ùå "+e.message); }
  }
  async function login() {
    const email = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      toast("‚úÖ Logged in!");
    } catch (e) { toast("‚ùå "+e.message); }
  }
  async function logout() { await signOut(auth); toast("üö™ Logged out!"); }

  onAuthStateChanged(auth, (user)=>{
    if(user){
      document.getElementById("loginScreen").style.display="none";
      document.getElementById("welcomeUser").textContent="Welcome "+user.email;
      renderHistory();
    } else {
      document.getElementById("loginScreen").style.display="flex";
      document.getElementById("welcomeUser").textContent="";
      document.getElementById("history").innerHTML="";
    }
  });

  // ===== Cipher logic =====
  const vmap={a:"1",e:"2",i:"3",o:"4",u:"5"};
  const vrev={"1":"a","2":"e","3":"i","4":"o","5":"u"};
  function encode(){const txt=document.getElementById("input").value;let out="";for(const c of txt){if(vmap[c])out+=vmap[c];else if(vmap[c.toLowerCase()])out+=vmap[c.toLowerCase()];else if(/[A-Za-z]/.test(c))out+=c+"a";else out+=c;}document.getElementById("output").value=out;addHist("Encoded",txt,out);}
  function decode(){const txt=document.getElementById("input").value;let out="";for(let i=0;i<txt.length;i++){const c=txt[i];if(vrev[c])out+=vrev[c];else if(/[A-Za-z]/.test(c)&&txt[i+1]==="a"){out+=c;i++;}else out+=c;}document.getElementById("output").value=out;addHist("Decoded",txt,out);}
  function smartDetect(){const txt=document.getElementById("input").value;if(/[1-5]/.test(txt))decode();else encode();}
  function copyResult(){navigator.clipboard.writeText(document.getElementById("output").value);toast("Copied")}
  function clearAll(){document.getElementById("input").value="";document.getElementById("output").value="";}

  // ===== Cloud History (Firestore) =====
  async function addHist(type,inp,res){
    const user = auth.currentUser;
    if(!user) return;
    await addDoc(collection(db,"users",user.uid,"history"),{
      type,inp,res,date:new Date().toLocaleString()
    });
    renderHistory();
  }
  async function renderHistory(){
    const user = auth.currentUser;
    if(!user) return;
    const q = query(collection(db,"users",user.uid,"history"),orderBy("date","desc"));
    const snap = await getDocs(q);
    let html="";
    snap.forEach(docu=>{
      let d=docu.data();
      html+=`<div class='history-item'><b>${d.type}</b>: ${d.res}<br><small>${d.date}</small></div>`;
    });
    document.getElementById("history").innerHTML=html||"No history";
  }
  async function clearHistory(){
    const user = auth.currentUser;
    if(!user) return;
    const q = query(collection(db,"users",user.uid,"history"));
    const snap = await getDocs(q);
    snap.forEach(async(docu)=>await deleteDoc(doc(db,"users",user.uid,"history",docu.id)));
    renderHistory();
  }

  // toast
  function toast(m){const t=document.getElementById("toast");t.textContent=m;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2000);}
  document.getElementById("year").textContent=new Date().getFullYear();
</script>
</body>
</html>