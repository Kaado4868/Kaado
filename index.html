<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>üîê Secret Cipher</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    :root {
      --glass: rgba(255,255,255,0.08);
      --card-glow: 0 8px 30px rgba(0,0,0,0.45);
      --accent1: #ff5f8b;
      --accent2: #7b61ff;
      --accent3: #00f0ff;
      --accent4: #5efc82;
    }
    body {
      margin: 0; font-family: Inter, "Segoe UI", Arial, sans-serif; color: #fff;
      background: linear-gradient(135deg,#0a0f1f,#0d1117 40%,#121826 100%);
      min-height: 100vh; display: flex; flex-direction: column;
    }
    header { padding: 20px; text-align: center; background: rgba(0,0,0,0.3); }
    main { flex:1; display:flex; gap:20px; padding:20px; flex-wrap:wrap; justify-content:center; }
    section, aside { min-width:320px; flex:1; border-radius:16px; padding:18px; background:var(--glass);
      box-shadow:var(--card-glow); backdrop-filter:blur(8px); }
    textarea { width:100%; min-height:110px; border-radius:12px; border:0; padding:12px; margin:10px 0;
      background:rgba(0,0,0,0.35); color:#fff; font-size:15px; }
    .controls { display:flex; gap:10px; flex-wrap:wrap; }
    button { padding:10px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:700; color:#fff;
      background-image:linear-gradient(90deg,rgba(255,95,139,0.95),rgba(123,97,255,0.95)); }
    button.secondary { background-image:linear-gradient(90deg,#00c6ff,#0072ff); }
    button.danger { background-image:linear-gradient(90deg,#ff8a65,#e53935); }
    .history-item { padding:8px; border-radius:8px; margin-bottom:8px; background:rgba(0,0,0,0.14); font-size:14px; }
    footer { text-align:center; padding:10px; }
    #toast { position:fixed; bottom:26px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8);
      padding:10px 16px; border-radius:22px; opacity:0; transition:.25s; }
    #toast.show { opacity:1; transform:translateX(-50%) translateY(-6px); }

    /* login modal */
    #loginScreen { position:fixed; inset:0; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:99; }
    #loginBox { background:#1a1f2f; padding:20px; border-radius:12px; width:300px; }
    input { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:0; background:rgba(255,255,255,0.1); color:#fff; }
  </style>
</head>
<body>
  <!-- Login -->
  <div id="loginScreen">
    <div id="loginBox">
      <h2>üîë Login / Sign Up</h2>
      <input id="username" placeholder="Email">
      <input id="password" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
      <button onclick="signup()" class="secondary">Sign Up</button>
      <button onclick="guestMode()" class="danger">Continue as Guest</button>
    </div>
  </div>

  <header>
    <h1>üîê Secret Cipher</h1>
    <p id="welcomeUser"></p>
    <button onclick="logout()" class="danger">Logout</button>
  </header>

  <main>
    <section>
      <h3>üìù Cipher Tool</h3>
      <textarea id="input" placeholder="Type message..."></textarea>
      <textarea id="output" readonly placeholder="Result..."></textarea>
      <div class="controls">
        <button onclick="encode()">Encode</button>
        <button onclick="decode()">Decode</button>
        <button onclick="smartDetect()">Smart Detect</button>
        <button onclick="copyResult()" class="secondary">Copy</button>
        <button onclick="clearAll()" class="danger">Clear</button>
      </div>

      <!-- Quiz -->
      <div style="margin-top:16px; background:rgba(0,0,0,0.25); padding:12px; border-radius:10px">
        <h3>üß© Quiz</h3>
        <div id="quiz-container">Not started</div>
        <button onclick="startQuiz()">Start Quiz</button>
      </div>

      <h4>üèÜ Leaderboard</h4>
      <div id="leaderboard"></div>
    </section>

    <aside>
      <h3>üìú History</h3>
      <div id="history"></div>
      <button onclick="clearHistory()" class="danger">Clear History</button>
    </aside>
  </main>

  <footer>¬© <span id="year"></span> Secret Cipher</footer>
  <div id="toast"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBOfDcEpw-p7DNuoUKqlGlTC782yiVdf00",
    authDomain: "cipher-e6c22.firebaseapp.com",
    projectId: "cipher-e6c22",
    storageBucket: "cipher-e6c22.appspot.com",
    messagingSenderId: "345358817477",
    appId: "1:345358817477:web:7ba4dd380d634b559038ac",
    measurementId: "G-CN75P4JDPW"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const inputEl=document.getElementById("input");
  const outputEl=document.getElementById("output");
  const historyEl=document.getElementById("history");

  function toast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2000);}

  // ---------------- AUTH ----------------
  async function signup(){
    const email=document.getElementById("username").value.trim();
    const pass=document.getElementById("password").value.trim();
    try{
      await createUserWithEmailAndPassword(auth,email,pass);
      toast("Account created ‚úÖ");
    }catch(e){toast(e.message);}
  }

  async function login(){
    const email=document.getElementById("username").value.trim();
    const pass=document.getElementById("password").value.trim();
    try{
      await signInWithEmailAndPassword(auth,email,pass);
      toast("Logged in ‚úÖ");
    }catch(e){toast(e.message);}
  }

  async function logout(){
    await signOut(auth);
    toast("Logged out");
  }

  function guestMode(){
    localStorage.setItem("guestMode","true");
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("welcomeUser").textContent="Welcome Guest";
  }

  onAuthStateChanged(auth,(user)=>{
    if(user){
      document.getElementById("loginScreen").style.display="none";
      document.getElementById("welcomeUser").textContent="Welcome "+user.email;
      loadUserData();
    }else if(!localStorage.getItem("guestMode")){
      document.getElementById("loginScreen").style.display="flex";
    }
  });

  // ---------------- DATA ----------------
  async function addHist(type,inp,res){
    history.unshift({type,inp,res,date:new Date().toLocaleString()});
    history=history.slice(0,20);
    renderHistory();
    localStorage.setItem("cipherHistory",JSON.stringify(history));

    if(auth.currentUser){
      const ref=doc(db,"users",auth.currentUser.uid);
      await setDoc(ref,{history:arrayUnion({type,inp,res,date:new Date().toISOString()})},{merge:true});
    }
  }

  async function loadUserData(){
    if(!auth.currentUser)return;
    const ref=doc(db,"users",auth.currentUser.uid);
    const snap=await getDoc(ref);
    if(snap.exists()){
      const data=snap.data();
      if(data.history){
        history=data.history;
        renderHistory();
      }
      if(data.scores){
        leaderboard=data.scores;
        renderLeaderboard();
      }
    }
  }

  // ---------------- CIPHER ----------------
  let history=JSON.parse(localStorage.getItem("cipherHistory")||"[]");
  let leaderboard=[];
  const vmap={a:"1",e:"2",i:"3",o:"4",u:"5"};
  const vrev={"1":"a","2":"e","3":"i","4":"o","5":"u"};

  function encode(){const txt=inputEl.value;let out="";for(const c of txt){if(vmap[c])out+=vmap[c];else if(vmap[c.toLowerCase()])out+=vmap[c.toLowerCase()];else if(/[A-Za-z]/.test(c))out+=c+"a";else out+=c;}outputEl.value=out;addHist("Encoded",txt,out);}
  function decode(){const txt=inputEl.value;let out="";for(let i=0;i<txt.length;i++){const c=txt[i];if(vrev[c])out+=vrev[c];else if(/[A-Za-z]/.test(c)&&txt[i+1]==="a"){out+=c;i++;}else out+=c;}outputEl.value=out;addHist("Decoded",txt,out);}
  function smartDetect(){const txt=inputEl.value;if(/[1-5]/.test(txt))decode();else encode();}
  function copyResult(){navigator.clipboard.writeText(outputEl.value);toast("Copied")}
  function clearAll(){inputEl.value="";outputEl.value="";}
  function renderHistory(){historyEl.innerHTML=history.map(h=>`<div class='history-item'><b>${h.type}</b>: ${h.res}<br><small>${h.date}</small></div>`).join("")||"No history";}
  function clearHistory(){history=[];localStorage.removeItem("cipherHistory");renderHistory();}

  // ---------------- QUIZ ----------------
  const qs=["The quick brown fox jumps over the lazy dog.","Knowledge is power.","Dream big and dare to fail."];
  let qi=0,score=0,pool=[];
  function startQuiz(){qi=0;score=0;pool=[...qs].sort(()=>Math.random()-0.5).slice(0,3);showQ();}
  function showQ(){if(qi>=pool.length)return endQ();let s=pool[qi];let enc=encSen(s);document.getElementById("quiz-container").innerHTML=`<div><b>Q${qi+1}</b>: ${enc}</div><input id='ans'><button onclick="subAns('${s.replace(/'/g,"\\'")}')">Submit</button>`;}
  function subAns(correct){let a=document.getElementById("ans").value;if(a.toLowerCase()===correct.toLowerCase()){score++;toast("‚úÖ")}else toast("‚ùå");qi++;showQ();}
  function endQ(){leaderboard.unshift(score);leaderboard=leaderboard.slice(0,5);renderLeaderboard();document.getElementById("quiz-container").innerHTML=`Done! Score: ${score}/${pool.length}`;if(auth.currentUser){const ref=doc(db,"users",auth.currentUser.uid);setDoc(ref,{scores:arrayUnion(score)},{merge:true});}}
  function encSen(txt){let out="";for(const c of txt){if(vmap[c])out+=vmap[c];else if(vmap[c.toLowerCase()])out+=vmap[c.toLowerCase()];else if(/[A-Za-z]/.test(c))out+=c+"a";else out+=c;}return out;}
  function renderLeaderboard(){document.getElementById("leaderboard").innerHTML=leaderboard.map((x,i)=>`#${i+1} ‚Üí ${x}`).join("<br>")||"No scores";}

  // init
  document.getElementById("year").textContent=new Date().getFullYear();
  renderHistory();

  // Expose functions globally
  window.signup=signup; window.login=login; window.logout=logout; window.guestMode=guestMode;
  window.encode=encode; window.decode=decode; window.smartDetect=smartDetect;
  window.copyResult=copyResult; window.clearAll=clearAll;
  window.startQuiz=startQuiz; window.clearHistory=clearHistory;
</script>
</body>
</html>